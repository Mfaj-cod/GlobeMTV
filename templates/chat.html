{% extends "base.html" %}

{% block title %}Chatbot | GlobeMTV{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="chat-container">
    <div class="chat-header text-center text-white mb-4">
      <h2 class="head">
        Ask anything
      </h2>
    </div>
    
    <div class="chat-window" id="chat-window">
      <!-- Messages will be appended here -->
    </div>
    
    <div class="chat-input-container">
      <form id="chat-form" class="chat-form">
        <div class="input-group">
          <input type="text" id="user-input" class="form-control chat-input" placeholder="Type your message..." autocomplete="off" required>
          <button class="btn chat-send-btn text-white" type="submit">
            <!-- <i class="bi bi-send text-white"></i> -->
            <span> Send</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>


<script>
  const chatForm = document.getElementById("chat-form");
  const chatWindow = document.getElementById("chat-window");
  const userInput = document.getElementById("user-input");

  chatForm.addEventListener("submit", async function(e) {
    e.preventDefault();
    const message = userInput.value.trim();
    if (!message) return;

    appendMessage("user", message);
    userInput.value = "";

    // Send to backend (Groq model endpoint)
    try {
      const res = await fetch("/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message })
      });
      const data = await res.json();
      appendMessage("bot", data.response || "No response received.");
    } catch (err) {
      appendMessage("bot", "⚠️ Error connecting to server.");
    }
  });

  function appendMessage(sender, text) {
    const msgDiv = document.createElement("div");
    msgDiv.classList.add("chat-message", sender);

    // Render markdown → HTML
    msgDiv.innerHTML = marked.parse(text);

    chatWindow.appendChild(msgDiv);
    chatWindow.scrollTop = chatWindow.scrollHeight;
  }

</script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

{% endblock %}
